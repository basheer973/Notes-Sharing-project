<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Notes Sharing Portal</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #fffde7;
      margin: 0;
      padding: 0;
      text-align: center;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      overflow-x: hidden;
    }
    .container {
      width: 90%;
      max-width: 700px;
      background: #fff9c4;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      opacity: 0;
      transform: translateY(-50px);
      animation: fadeSlideUp 1s forwards;
      text-align: center;
    }
    h2 {
      margin-bottom: 20px;
      color: black;
      font-weight: bold;
      font-size: 2.5rem;
      animation: fadeSlideDown 1s ease-out forwards;
    }
    button, input {
      width: 90%;
      padding: 10px;
      margin: 10px 0;
      border-radius: 8px;
      border: 1px solid #fbc02d;
      font-size: 16px;
      transition: transform 0.2s;
    }
    button:hover, input:hover { transform: scale(1.05); }
    button {
      background: #fbc02d;
      color: black;
      border: none;
      cursor: pointer;
      font-weight: bold;
    }
    .grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-top: 20px;
    }
    .card {
      padding: 15px;
      background: #ffeb3b;
      color: black;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      transition: transform 0.3s, box-shadow 0.3s;
    }
    .card:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }
    .hidden { display: none; }
    .back-btn { width: auto; padding: 8px 16px; margin-top: 20px; background: #fbc02d; color: black; }
    ul { list-style: none; padding: 0; }
    li { margin: 5px 0; }
    a { text-decoration: none; color: #f57f17; margin-right: 10px; }
    small { display: block; margin-top: 15px; cursor: pointer; color: #f57f17; }
    /* Animations */
    @keyframes fadeIn { 0% {opacity:0;} 100% {opacity:1;} }
    @keyframes fadeSlideDown { 0% {opacity:0; transform: translateY(-20px);} 100% {opacity:1; transform: translateY(0);} }
    @keyframes fadeSlideUp { 0% {opacity:0; transform: translateY(50px);} 100% {opacity:1; transform: translateY(0);} }
    @keyframes slideFromLeft { 0% {transform: translateX(-100%); opacity:0;} 100% {transform: translateX(0); opacity:1;} }
    @keyframes slideFromRight { 0% {transform: translateX(100%); opacity:0;} 100% {transform: translateX(0); opacity:1;} }
    @keyframes slideFromBottom { 0% {transform: translateY(100%); opacity:0;} 100% {transform: translateY(0); opacity:1;} }

    #welcomeSlide {
      position: fixed;
      top: 0; left: 0;
      width: 100%;
      height: 100vh;
      background: linear-gradient(135deg, #fdd835, #f57f17);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      overflow: hidden;
    }
    #welcomeSlide h2 {
      font-size: 3rem;
      color: black;
      font-weight: bold;
      margin-bottom: 20px;
      animation: slideFromLeft 1s ease-out forwards;
    }
    #welcomeSlide p {
      font-size: 1.5rem;
      color: black;
      margin-bottom: 30px;
      animation: slideFromRight 1s ease-out 0.5s forwards;
      opacity: 0;
    }
    #welcomeSlide button {
      width: auto;
      padding: 12px 24px;
      font-size: 18px;
      border-radius: 8px;
      border: none;
      background: white;
      color: #f57f17;
      font-weight: bold;
      cursor: pointer;
      animation: slideFromBottom 1s ease-out 1s forwards;
      opacity: 0;
    }
    #welcomeSlide button:hover { background: #ffe082; }
  </style>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.3.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.3.1/firebase-storage-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.3.1/firebase-firestore-compat.js"></script>
</head>
<body>
  <!-- Welcome Slide -->
  <div id="welcomeSlide">
    <h2>✨ Notes Sharing Portal ✨</h2>
    <p>Share and access study materials with ease.</p>
    <button onclick="goToEntrance()">Continue →</button>
  </div>

  <!-- Entrance Page -->
  <div class="container hidden" id="entrancePage">
    <h2>Notes Sharing Portal</h2>
    <button onclick="goToSemesters('student')">Enter</button>
    <small onclick="goToFacultyLogin()">Faculty Login</small>
  </div>

  <!-- Faculty Login -->
  <div class="container hidden" id="facultyLoginPage">
    <h2>Faculty Login</h2>
    <input type="password" id="facultyCode" placeholder="Enter Faculty Code">
    <button onclick="checkFacultyCode()">Login</button>
    <button class="back-btn" onclick="backToEntrance()">← Back</button>
  </div>

  <!-- Semester Page -->
  <div class="container hidden" id="semesterPage">
    <h2>Select Semester</h2>
    <div class="grid" id="semesterGrid"></div>
    <button class="back-btn" onclick="backToEntrance()">← Back</button>
  </div>

  <!-- Subjects Page -->
  <div class="container hidden" id="subjectsPage">
    <h2 id="semesterTitle"></h2>
    <div class="grid" id="subjectsGrid"></div>
    <button class="back-btn" onclick="backToSemesters()">← Back</button>
  </div>

  <!-- Units Page -->
  <div class="container hidden" id="unitsPage">
    <h2 id="subjectTitle"></h2>
    <div class="grid" id="unitsGrid"></div>
    <button class="back-btn" onclick="backToSubjects()">← Back</button>
  </div>

  <!-- Upload/Download Page -->
  <div class="container hidden" id="uploadPage">
    <h2 id="unitTitle"></h2>
    <div id="facultySection" class="hidden">
      <input type="file" id="fileInput">
      <button onclick="uploadFile()">Upload Notes</button>
    </div>
    <h3>Available Notes:</h3>
    <ul id="notesList"></ul>
    <button class="back-btn" onclick="backToUnits()">← Back</button>
  </div>

  <script>
    // -------- Firebase Initialization --------
    const firebaseConfig = {
      apiKey: "AIzaSyCfrAiDhkRTZ13lhDxdBaBk3w-vo_x7XYs",
  authDomain: "notes-sharing-system-6fa21.firebaseapp.com",
  projectId: "notes-sharing-system-6fa21",
  storageBucket: "notes-sharing-system-6fa21.firebasestorage.app",
  messagingSenderId: "131931265921",
  appId: "1:131931265921:web:156b2152aa790b3a872680",
  measurementId: "G-W0THJ9R4H2"
    };
    firebase.initializeApp(firebaseConfig);
    const storage = firebase.storage();
    const db = firebase.firestore();

    // -------- State & Syllabus Data --------
    let currentRole = "student",
        currentSemester = "",
        currentSubject = "",
        currentUnit = "",
        currentType = "units";

    const syllabus = {
      "1-1": ["Engineering chemistry","Programming in C","BCME","Mathematics-I","English"],
      "1-2": ["Engineering physics","Data Structures","Mathematics-II","BEEE","Engineering Graphics"],
      "2-1": ["DL&CO","Discrete Mathematics","OOPs with Java","UHV","Advanced Data Structures"],
      "2-2": ["Operating Systems","DBMS","Probability & Statistics","MEFA","Software Engineering"],
      "3-1": ["FLAT","Computer Networks","DWDM","EDC","OOAD"],
      "3-2": ["Artificial Intelligence","Cloud Computing","Information Security","Data Mining","Open Elective-II"],
      "4-1": ["Big Data Analytics","IoT","Deep Learning","Professional Elective-I","Open Elective-III"],
      "4-2": ["Project Work","Seminar","Comprehensive Viva","Professional Elective-II","Open Elective-IV"]
    };

    // -------- Navigation UI Functions --------
    function goToEntrance() {
      document.getElementById("welcomeSlide").style.display = "none";
      showPage("entrancePage");
    }
    function goToFacultyLogin() {
      hidePages();
      showPage("facultyLoginPage");
    }
    function checkFacultyCode() {
      let entered = document.getElementById("facultyCode").value.trim();
      if (entered === "FAC123") {
        currentRole = "faculty";
        goToSemesters("faculty");
      } else {
        alert("Invalid Faculty Code!");
      }
    }
    function goToSemesters(role) {
      currentRole = role;
      hidePages();
      showPage("semesterPage");
      const grid = document.getElementById("semesterGrid");
      grid.innerHTML = "";
      Object.keys(syllabus).forEach(sem => {
        let div = document.createElement("div");
        div.className = "card";
        div.innerText = sem.replace("-", " - Semester ");
        div.onclick = () => goToSubjects(sem);
        grid.appendChild(div);
      });
    }
    function goToSubjects(semester) {
      currentSemester = semester;
      hidePages();
      showPage("subjectsPage");
      document.getElementById("semesterTitle").innerText = "Subjects (" + semester + ")";
      const grid = document.getElementById("subjectsGrid");
      grid.innerHTML = "";
      syllabus[semester].forEach(sub => {
        let div = document.createElement("div");
        div.className = "card";
        div.innerText = sub;
        div.onclick = () => goToUnits(sub);
        grid.appendChild(div);
      });
    }
    function goToUnits(subject) {
      currentSubject = subject;
      hidePages();
      showPage("unitsPage");
      document.getElementById("subjectTitle").innerText = subject;
      const grid = document.getElementById("unitsGrid");
      grid.innerHTML = "";
      ["Unit-1","Unit-2","Unit-3","Unit-4","Unit-5","Syllabus"].forEach(unit => {
        let div = document.createElement("div");
        div.className = "card";
        div.innerText = unit;
        div.onclick = () => openUnit(unit, "units");
        grid.appendChild(div);
      });
      let pqDiv = document.createElement("div");
      pqDiv.className = "card";
      pqDiv.innerText = "Previous Question Papers";
      pqDiv.onclick = () => openUnit("Previous Question Papers", "pq");
      grid.appendChild(pqDiv);
    }
    function openUnit(unit, type) {
      currentUnit = unit;
      currentType = type;
      hidePages();
      showPage("uploadPage");
      document.getElementById("unitTitle").innerText = currentSubject + " - " + unit;
      if (currentRole === "faculty") {
        document.getElementById("facultySection").classList.remove("hidden");
      } else {
        document.getElementById("facultySection").classList.add("hidden");
      }
      loadNotes();
    }
    function backToEntrance() {
      if (currentRole === "faculty") {
        if (!confirm("Do you really want to exit? Your login will be cleared.")) return;
        currentRole = "student";
        document.getElementById("facultyCode").value = "";
      }
      hidePages();
      showPage("entrancePage");
    }
    function backToSemesters() { hidePages(); showPage("semesterPage"); }
    function backToSubjects() { hidePages(); showPage("subjectsPage"); }
    function backToUnits() { hidePages(); showPage("unitsPage"); }
    function hidePages() {
      document.querySelectorAll(".container").forEach(c => c.classList.add("hidden"));
    }
    function showPage(id) {
      const page = document.getElementById(id);
      page.classList.remove("hidden");
      page.style.animation = "fadeSlideUp 0.8s forwards";
    }

    // -------- Firebase File Handling --------
    async function uploadFile() {
      const fileInput = document.getElementById("fileInput");
      if (fileInput.files.length === 0) {
        alert("Please select a file!");
        return;
      }
      const file = fileInput.files[0];
      const path = `${currentSemester}/${currentSubject}/${currentUnit}/${currentType}/${file.name}`;
      const storageRef = storage.ref().child(path);
      try {
        await storageRef.put(file);
        const url = await storageRef.getDownloadURL();
        await db.collection("notes").add({
          semester: currentSemester,
          subject: currentSubject,
          unit: currentUnit,
          type: currentType,
          name: file.name,
          url,
          uploadedAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        alert("Uploaded Successfully!");
        fileInput.value = "";
        loadNotes();
      } catch (err) {
        console.error("Upload error:", err);
        alert("Upload failed!");
      }
    }

    async function loadNotes() {
      const keyQuery = db.collection("notes")
        .where("semester", "==", currentSemester)
        .where("subject", "==", currentSubject)
        .where("unit", "==", currentUnit)
        .where("type", "==", currentType)
        .orderBy("uploadedAt", "desc");

      const notesList = document.getElementById("notesList");
      notesList.innerHTML = "";
      try {
        const snapshot = await keyQuery.get();
        snapshot.forEach((doc, index) => {
          const data = doc.data();
          let li = document.createElement("li");
          li.innerHTML = `<a href="${data.url}" download="${data.name}">${data.name}</a>`;
          if (currentRole === "faculty") {
            li.innerHTML += ` <button onclick="deleteFile('${doc.id}')">Delete</button>`;
          }
          notesList.appendChild(li);
        });
      } catch (err) {
        console.error("Load notes error:", err);
        alert("Failed to load notes.");
      }
    }

    async function deleteFile(docId) {
      if (!confirm("Are you sure you want to delete this file?")) return;
      try {
        const docRef = db.collection("notes").doc(docId);
        const docSnap = await docRef.get();
        const data = docSnap.data();
        const path = `${data.semester}/${data.subject}/${data.unit}/${data.type}/${data.name}`;
        const storageRef = storage.ref().child(path);
        await storageRef.delete();
        await docRef.delete();
        loadNotes();
      } catch (err) {
        console.error("Delete error:", err);
        alert("Error deleting file!");
      }
    }

    // At start, show the entrance after welcome
    window.onload = () => {
      showPage("welcomeSlide"); // welcome first
    };
  </script>
</body>
</html>
